apiVersion: spark.stackable.tech/v1alpha1
kind: SparkApplication
metadata:
  name: kafka-test-output
  namespace: default
spec:
  sparkImage:
    productVersion: "3.5.6"
    pullPolicy: "IfNotPresent"
  mode: cluster
  # Set main application file to the new test script path
  mainApplicationFile: "local:///opt/spark/work-dir/kafka-test-output.py" 

  deps:
    requirements:
      - kafka-python==2.0.2

  sparkConf:
    spark.app.name: "KafkaTestOutput"
    spark.hadoop.fs.defaultFS: "hdfs://simple-hdfs-namenode-0.simple-hdfs-namenode.default.svc.cluster.local:8020"
    # Reduce memory for fast start
    spark.driver.memory: 512m
    spark.executor.memory: 512m

  env:
    - name: KAFKA_BOOTSTRAP_SERVERS
      value: "simple-kafka-broker-default-bootstrap.default.svc.cluster.local:9092"
    - name: KAFKA_TOPIC
      value: "test-topic"

  volumes: 
    - name: kafka-script
      configMap:
        name: kafka-test-script # Reference the new ConfigMap name